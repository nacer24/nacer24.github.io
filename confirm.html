getCountry()
  .then(country => {
    return fetch(WEB_APP_URL, {
      method: "POST",
      body: new URLSearchParams({
        email: email,
        country: country
      })
    });
  })
  .then(res => res.text())
  .then(text => {
    if (text.trim() === "OK") {
      location.href = EBOOK_URL;
    } else {
      document.getElementById("msg").textContent =
        "Error saving subscription: " + text;
    }
  })
  .catch(err => {
    document.getElementById("msg").textContent =
      "Network error: " + err.message;
  });
